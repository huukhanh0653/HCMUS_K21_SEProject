apiVersion: v1
kind: Secret
metadata:
  name: firebase-service-account
type: Opaque
data:
  key.json: IHsKICAgICAgICAgICAgICAgICAgInR5cGUiOiAic2VydmljZV9hY2NvdW50IiwKICAgICAgICAgICAgICAgICAgInByb2plY3RfaWQiOiAiZGlzY29yZC00ZWQ1ZCIsCiAgICAgICAgICAgICAgICAgICJwcml2YXRlX2tleV9pZCI6ICIwNTU4MjRlMmYxMTA4NDk4MDEyM2NhMTFiNzg3MTAxYjE4ZDVjOTU0IiwKICAgICAgICAgICAgICAgICAgInByaXZhdGVfa2V5IjogIi0tLS0tQkVHSU4gUFJJVkFURSBLRVktLS0tLVxuTUlJRXZRSUJBREFOQmdrcWhraUc5dzBCQVFFRkFBU0NCS2N3Z2dTakFnRUFBb0lCQVFDWUluMllNaFZHM0N1SVxuWHJrVU5SdjloSDNiUVpEYUJKQVgvV2hvWGpPRkE2SjFJRS9USFhkR0xlQWFRczVmUUhHZnM5WS9GczkxaldvdFxuUXQyempJNkZSdFNRT0JSUEppbDVCbUovdGFDeTB4WkpBd3JVeEEwb0QwRVpoeno4R1lwd3hCZnR0OGFyQ3cwc1xublJzaGFrL2oycllrY3o2UXpRMXFNa0Vsd0NNclhUSXlOMFpTa2ppOXltQ1RCLzliVHZTRUFoelUwdTdpQWVmaVxuYlZhYkNBZWlqS2ZKS3dNYm1vclovUGkyVittYjhKWUtvazd1c040aEx5RzBPVHFCbDVkN3EzSHdFdTNWVHRmVFxuMWgwa2dHejhDaWVZRTdsaitBZyt3TEwyZEUyL3JzdlM0MlZXUHViaERScWo1UHk5VWN2c2VWdnMyWDFHR0FZMlxuNzJUdW1ReGRBZ01CQUFFQ2dnRUFRTC9sUG9LS1piZE5XK1FjMTRubkdOWnNEb1p3VlNvOS9jZmZ5UlBXejVVRlxuYnQ1S3V5cStXZ01xYjJMaG5NNjd6V0hvSEwvam1qK080aWFrWDBmQ1hOMFJtVFFWQ0w3UVJlOCt1dVlkdUI1NVxuVEtmYjAwU0I2UHZkRkRWbjhsQVlpUGdjeXhNOW5neTlGYkRrSEN1NFJ0ME9TcU0yRE1FSkpacXYrWlkySWIwSFxubzNYbFUycjZvL0tYbldHMkZ4aWZ3Rm93dGYwdFNBQUQzV1p5eFBva2ZGSVl6YmN1SVFHOHNobnY1OFM1Y2xkYVxuYnNEd2Z4bnN5Z05Fd0NXNVdxaFRwOFJyNUp1NXlQekpYbTlYWVBpRUI3aStzSFlBQTd3eWZVVHFwa3pHNExzb1xuN21yaWVtc0xaZE5sRk9IdXJZcnk3VERQbTZPbjQrbUhhcnpIdXVTakxRS0JnUURHZDZ0ZU5RTDN4ZVl3TDJXVlxuVFMvbFg1eUh1SXRDRW44WFlPUFh1eExNd1B1VWt4dnpORnZrWW9XSkt4Yy9NQUs2K3JTUllwRlFRWE56MXUzTFxuVWZtelBmODcwNFpuU3RnRnNtRHFabWVTYUNzeW1TcEY0bFBmRTRsVjZYV21IbGZLb21xTU1EL3RSWkhCUHB5VFxuUVY5NEpkQVBvQ3F4MXYwZmxUaitMaDlSTHdLQmdRREVQSFNJVURnTndaTUJUQ2QveFp2dmVvRXl3aFNQaUFmU1xuZ01ObHlhTlV3aldrczVFeWlnSGl5M0JVK2Y4MDdOWEJyTkpzc3RkUTBxd2lTRndybGtpMVZPYTkvWkZYSVZ6SFxubnJQVzNBU2loRUxtb1dIcWxWTnlzcmNxdWVjdEVFRTZnQTQ2cTVwL0tuQnRwaGFOYVZHZURUMzBiMkhTM09mdVxuem9ra0Jhb2dNd0tCZ0ZNelE4SUFremZ2M0tvQ2xLRmNkR0hDRFVyUVVJRG9aQ01XMlMxTkhYcDh4SHJxbU9NQlxuNWl2K0tXRHhrWk5KdXp0TGNuc29TU2JONldwOGhiK2dvLzlDVkVkdVMzL3QzbFcxQysvMzhoOXNULytzT2c2RlxuN1FjdGwzdE9uYVdBUHVtUjRQellGVlNRdjZPMWJjcEZzNUlZdC9wMCtMRUpJYUFsM0hpaU9UcTlBb0dBRHl6TlxucGl6dDZNSnJaOUpIeTYyd1hWaVAzU2o5Qmd4eTdtaGVzK1JmNlJJTHErem04WTJTajhORHNJNlVtYmNtNEk5SVxueG5jZUIzWURNYk4relRBVjkwL1ZlQ08vdFlreTc0enFRMWRJVkhqOTQyL2ZicENWbjIwS2xSZEROVXpvZm1tZ1xuc0JETkpjQldhV1JLb2l6ZXp1WWZRR1BNb00zTWNiOHZBOFljWGRrQ2dZRUFrSHEycnRmcVNaQlpUYm5IS0g3SFxueUd1OUhaS2lTSU0rM21PVUZDUTk2WkprK2dNOTRVR3ZlNVNtTzYxQ0JlMHkvVGJ6RmpzN1dZcTYrejhhRXZQUlxuMDI3ZDM5NlFIRHN0THNPcUpLdC9hMDUyNDN5ZndrU3VSV2xFRDhTaFRkWVM1V2s4Z0daZlR3OFF1alVMMnRkbVxuSHZDdThSaVJ6V0RyUWdNS04vbHNJSjg9XG4tLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tXG4iLAogICAgICAgICAgICAgICAgICAiY2xpZW50X2VtYWlsIjogImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGRpc2NvcmQtNGVkNWQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICAgICAgICAgICAgICAgICAiY2xpZW50X2lkIjogIjEwNTA1NjExNjgxMTI5MzM5NjgzMiIsCiAgICAgICAgICAgICAgICAgICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgICAgICAgICAgICAgICAgICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4iLAogICAgICAgICAgICAgICAgICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgICAgICAgICAgICAgICAgICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2ZpcmViYXNlLWFkbWluc2RrLWZic3ZjJTQwZGlzY29yZC00ZWQ1ZC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgICAgICAgICAgICAgICAgICJ1bml2ZXJzZV9kb21haW4iOiAiZ29vZ2xlYXBpcy5jb20iCiAgICAgICAgICAgICAgICB9
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-chat-user-service
  labels:
    app: echo-chat-user-service
spec:
  replicas: 1
  selector:
    matchLabels:
      app: echo-chat-user-service
  template:
    metadata:
      labels:
        app: echo-chat-user-service
    spec:
      containers:
        - name: echo-chat-user-service
          image: huukhanh0653/echo-chat-user-service:latest
          ports:
            - containerPort: 8081
          env:
            - name: FIREBASE_SERVICE_ACCOUNT_KEY
              value: /var/secrets/firebase/key.json
            - name: POSTGRES_SINGAPORE_CONNECTION_STRING
              value: "postgresql://postgres.iuaklcffbnuipnfxeshq:_3guQc4jik-zmWs@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres"
          volumeMounts:
            - name: firebase-service-account-volume
              mountPath: /var/secrets/firebase
              readOnly: true
          resources:
            requests:
              cpu: "500m"
              memory: "512Mi"
            limits:
              cpu: "1000m"
              memory: "1Gi"
      volumes:
        - name: firebase-service-account-volume
          secret:
            secretName: firebase-service-account

---
apiVersion: v1
kind: Service
metadata:
  name: echo-chat-user-service
spec:
  selector:
    app: echo-chat-user-service
  ports:
    - protocol: TCP
      port: 8081
      targetPort: 8081
  type: ClusterIP